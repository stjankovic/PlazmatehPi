<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Plazmateh IPC</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
    <link rel="shortcut icon" href="../img/favicon.png" type="image/png">
    <link href="../node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../styles.css">
</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="fixed-item">
            <svg id="openHiddenWindow" xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="black"
                class="bi bi-list" viewBox="0 0 16 16">
                <path fill-rule="evenodd"
                    d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5" />
            </svg>
        </div>

        <a class="navbar-brand" id="cur-dis">
            <img src="../img/Plazmateh.png" alt="Logo" height="25" draggable="false">
        </a>

        <div id="clock"></div>
    </nav>

    <!-- Hidden window content -->
    <div id="hiddenWindow">
        <div class="fixed-item">
            <svg onclick="closeHiddenWindow();" xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="black"
                class="bi bi-x-lg" viewBox="0 0 16 16">
                <path
                    d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z" />
            </svg>
        </div>
        <!-- fixed-item -->
        <button id="exitButton" type="button" class="btn btn-danger">Exit Application</button><br>
        <div class="">Plazmateh IPC</div>
        <div class="">ver 01.00.</div>

    </div>

    <div id="mainview" class="container-fluid">
        <div id="rrow" class="row">
            <div class="col-md-1" style="background-color: #d4d4d4;">
                <!-- MENU -->
                <ul class="list-group border-0 py-1">
                    <li id="changeMachine" class="list-group-item border-0 py-1 my-1 fs-6">MACHINE</li>
                    <li id="changeParameters" class="list-group-item border-0 py-1 my-1 fs-6">PARAMETERS</li>
                    <li id="changeAlarms" class="list-group-item border-0 py-1 my-1 fs-6">ALARMS</li>
                    <li id="changeLimits" class="list-group-item border-0 py-1 my-1 fs-6">LIMITS</li>
                    <li id="changeRecipes" class="list-group-item border-0 py-1 my-1 fs-6">RECIPES</li>
                    <li id="changeNetwork" class="list-group-item border-0 py-1 my-1 fs-6">NETWORK</li>
                    <li id="changeDevices" class="list-group-item border-0 py-1 my-1 fs-6">DEVICES</li>
                    <li id="changeSettings" class="list-group-item border-0 py-1 my-1 fs-6">SETTINGS</li>
                    <li id="changeLicense" class="list-group-item border-0 py-1 my-1 fs-6">LICENSE</li>
                </ul>
                
            </div>

            <div class="col-sm-10" style="background-color: #d4d4d4;">
                <div id="mainMachine" class="container mt-5 mb-5 pb-5 text-center">
                    <!-- GLAVNI PRIKAZ -->

                    <div class="container">
                        <div id="mainParam" class="container rounded" style="background-color: #f8f9fa; padding: 20px; padding-bottom: 0px;">
                            <h4>Parameters</h4> <br>
                            <nav aria-label="Page navigation">
                                <ul class="pagination pagination-sm justify-content-center">
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                                    </li>
                                    <li class="page-item active" aria-current="page">
                                        <a class="page-link" href="#">1</a>
                                    </li>
                                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                                    <li class="page-item"><a class="page-link" href="#">4</a></li>
                                    <li class="page-item"><a class="page-link" href="#">5</a></li>
                                    <li class="page-item"><a class="page-link" href="#">6</a></li>
                                    <li class="page-item">
                                        <a class="page-link" href="#">Next</a>
                                    </li>
                                </ul>
                            </nav>
                            <div id="cycle-table" class="container rounded mt-4" style="background-color: #f8f9fa; padding-bottom: 10px; padding-top: 30px;">
                                <div class="row justify-content-center">
                                    <div class="col-md-12">
                                        <table id="cycle-table" class="table table-bordered table-sm" style="font-size: 0.9rem;">
                                            <thead>
                                                <tr>
                                                    <th>Parameter Name</th>
                                                    <th>Parameter Value</th>
                                                    <th>Lock Parameter</th>
                                                    <th>Edit Parameter</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Populate this section with parameter data -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    

                </div>
            </div>

        </div>
    </div>

    <!-- Modal for editing parameter lock status -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel">Edit Parameter Lock Status</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Change lock status for <span id="parameterName"></span>:</p>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="lockCheckbox">
                    <label class="form-check-label" for="lockCheckbox">Lock Parameter</label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="saveChangesBtn">Save Changes</button>
            </div>
        </div>
    </div>
</div>

    <script src="../scripts/pop-menu.js"></script>
    <script src="../scripts/clock.js"></script>
    <script src="../scripts/renderer.js"></script>
    <script src="../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Function to generate table rows dynamically
        function generateTableRows(data) {
            return data.map((item, index) => `
                <tr>
                    <td>${item.parameterName}</td>
                    <td>${item.parameterValue}</td>
                    <td style="width: 150px;">
                        ${item.stateLocked ?
                            `<button type="button" class="btn btn-danger btn-sm edit-btn" style="color: white !important; width: 100px; padding-bottom: 5px !important; padding-top: 0px !important" data-index="${index}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" class="bi bi-lock-fill" viewBox="0 0 16 16">
                                    <path fill="black" d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2m3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2"/>
                                </svg>
                            </button>` :
                            `<button type="button" class="btn btn-success btn-sm edit-btn" style="color: white !important; width: 100px; padding-bottom: 5px !important; padding-top: 0px !important" data-index="${index}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" class="bi bi-unlock-fill" viewBox="0 0 16 16">
                                    <path fill="black" d="M11 1a2 2 0 0 0-2 2v4a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h5V3a3 3 0 0 1 6 0v4a.5.5 0 0 1-1 0V3a2 2 0 0 0-2-2"/>
                                </svg>
                            </button>`
                        }
                    </td>
                    <td style="width: 150px;">
                        ${item.stateLocked ?
                            `<button disabled type="button" class="btn btn-danger btn-sm " style="color: white !important; width: 100px; padding-bottom: 5px !important; padding-top: 0px !important" data-index="${index}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pen-fill" viewBox="0 0 16 16">
                                    <path fill="black" d="m13.498.795.149-.149a1.207 1.207 0 1 1 1.707 1.708l-.149.148a1.5 1.5 0 0 1-.059 2.059L4.854 14.854a.5.5 0 0 1-.233.131l-4 1a.5.5 0 0 1-.606-.606l1-4a.5.5 0 0 1 .131-.232l9.642-9.642a.5.5 0 0 0-.642.056L6.854 4.854a.5.5 0 1 1-.708-.708L9.44.854A1.5 1.5 0 0 1 11.5.796a1.5 1.5 0 0 1 1.998-.001"/>
                                </svg>
                            </button>` :
                            `<button type="button" class="btn btn-success btn-sm" style="color: white !important; width: 100px; padding-bottom: 5px !important; padding-top: 0px !important" data-index="${index}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pen-fill" viewBox="0 0 16 16">
                                    <path fill="black" d="m13.498.795.149-.149a1.207 1.207 0 1 1 1.707 1.708l-.149.148a1.5 1.5 0 0 1-.059 2.059L4.854 14.854a.5.5 0 0 1-.233.131l-4 1a.5.5 0 0 1-.606-.606l1-4a.5.5 0 0 1 .131-.232l9.642-9.642a.5.5 0 0 0-.642.056L6.854 4.854a.5.5 0 1 1-.708-.708L9.44.854A1.5 1.5 0 0 1 11.5.796a1.5 1.5 0 0 1 1.998-.001"/>
                                </svg>
                            </button>`
                        }
                    </td>
                </tr>
            `).join('');
        }
            
        // Get the URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const readCurrentParametersParam = urlParams.get('readCurrentParameters');
        const readCurrentParameters = JSON.parse(readCurrentParametersParam);
    
        // Construct data array dynamically
        const data = [];
        for (const key in readCurrentParameters) {
            if (key.startsWith('parameterName_')) {
                const parameterNumber = key.slice(14); // Extract the number part of the key
                const parameterValueKey = `parameterVal_${parameterNumber}`;
                if (readCurrentParameters.hasOwnProperty(parameterValueKey)) {
                    const parameterName = readCurrentParameters[key];
                    const parameterValue = readCurrentParameters[parameterValueKey];
                    // Determine the state of the checkbox based on the value of state_locked_01
                    const stateLockedKey = `state_locked_${parameterNumber}`;
                    const stateLocked = readCurrentParameters[stateLockedKey]; // Convert to boolean
                    data.push({ parameterName, parameterValue, stateLocked });
                }
            }
        }
    
        // Get the table body element
        const tableBody = document.querySelector('#cycle-table tbody');
    
        // Generate rows and append them to the table body
        tableBody.innerHTML = generateTableRows(data);
    
        // Add click event listener to the edit buttons
        const editButtons = document.querySelectorAll('.edit-btn');
        editButtons.forEach((button, index) => {
            button.addEventListener('click', () => {
                const parameter = data[index];
                // Update modal content with parameter name and lock status
                const parameterNameSpan = document.getElementById('parameterName');
                parameterNameSpan.textContent = parameter.parameterName;
                const lockCheckbox = document.getElementById('lockCheckbox');
                lockCheckbox.checked = parameter.stateLocked;
                // Show the modal
                const editModal = new bootstrap.Modal(document.getElementById('editModal'));
                editModal.show();
                // Save changes button click handler
                const saveChangesBtn = document.getElementById('saveChangesBtn');
                saveChangesBtn.addEventListener('click', () => {
                    // Save changes to lock status
                    parameter.stateLocked = lockCheckbox.checked;
                    // Close the modal
                    editModal.hide();
                    // Optionally, you can perform additional actions here, like updating the UI or sending data to a server
                });
            });
        });
    </script>
    
    
    
    
</body>

</html>


<td style="text-align: center;">
    <button type="button" class="btn btn-danger btn-sm edit-btn" style="width: 200px; padding-bottom: 5px !important; padding-top: 0px !important" data-index="${index}">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-lock-fill" viewBox="0 0 16 16">
            <path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2m3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2"/>
        </svg>
    </button>
</td>